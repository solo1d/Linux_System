# 数组分配和访问

## 数组分配和访问

### 基本原则

C语言的一个不同寻常的特点是可以产生指向数组元素的指针,并对这些指针进行运算.  **`在机器代码中`**, **`这些指针会被翻译成地址计算.`**

X86-64的内存引用指令可以用来简化数组访问.

数组定义时的标示符, 可以用作指向数组开头的指针.

```ruby
例如有一个数组定义, 代码为:    int  a[10];        /* 表示是int类型的数组 */
如果访问下标为 5 的数组元素, 那么计算公式是:
                          a + 5 * 4
    有效范围是 0~9
```



### 指针运算

```ruby
C 语言允许对指针进行运算, 而计算出来的值会根据该指针引用的数据类型的大小进行伸缩.
     也就是说, 如果p是一个指向类型为 int 的数据的指针,p的值为 x  
             那么表达式   p+i  的值为  x + 4 * i       
可以对数组和指针应用数组下标操作.
     A[i] 等价于  *( p + i)
     
例子:
     int a[4]; /* 例如a的值是 0x0012 */
     &a[2] - a  = 2 ;   
        /* 计算过程: 首先取得数组2位置值,再取出值所在的地址,然后减去a地址,得到8,最后除以数据大小*/
        /*  ((a地址 +2*4) - a地址) /4 = 8 / 4 = 2  (得到的值为 long 类型, 因为是地址运算)*/
```



### 嵌套数组

```ruby
创建数组的数组时, 数组分配和引用的一般原则也是成立的.
    例如 :  int A[5][3];
         等价于如下声明:
              typedef int row3_t [3];
              row3_t A[5];
数组元素在内存中按照 "行优先" 的顺序排列, 意味着第0行的所有元素,可以写作A[0],
     后面跟着第一行的所有元素(A[1]), 以此类推.
```

| 行 | 元素 | 地址 |
| :---: | :---: | :---: |
| A\[0\] | A \[0\] \[0\] | x |
| A\[0\] | A\[0\] \[1\] | x+4 |
| A\[0\] | A\[0\] \[2\] | x+8 |
| A\[1\] | A\[1\] \[0\] | x+12 |
| ... | ... | ... |







