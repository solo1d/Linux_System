# 链接

**链接是将各种代码和数据片段手机并组合成为一个单一文件的过程, 这个文件可被加载\(复制\)到内存并执行.**

* 链接可以执行于**编译**时, 也就是在源代码被翻译成机器代码时;
* 也可以执行与加**载**时, 也就是在程序被**加载器**加载到内存并执行时.
* **运行**时, 也就是程序应用来执行.

**链接是由连接器的程序自动执行的.**

**链接**将**分离编译**成为可能.\(`多文件编译`\).

* **理解链接器的好处**
  * **有利于大型程序构造**
  * **避免危险的编程错误**
  * **理解语言的作用域的实现**
  * **理解其他重要的系统概念**
  * **利用共享库**

## 编译器驱动程序

* **gcc驱动程序**
  * **`gcc  参数和选项  文件`**
* **cpp  预处理     将 `.c` 文件翻译成  ASCII码的  `.i`   中间文件**
  * **`cpp  main.c -o main.i`**
* **ccl  编译器     将   `.i` 文件翻译成ASCII码的  `.s`  汇编文件**
  * **`ccl   main.i   -o  main.s`**
* **as  汇编器   将 `.s` 文件翻译成一个可重定位目标文件 `.o`**
  * **`as  main.s   -o  main.o`**
* **ld    链接器   将 `.o` 文件以及一些必要的`系统目标文件`组合起来,创建一个可执行目标文件.**
  * **`ld  main.s   -o  prog`**
* **shell 调用操作系统中一个叫做 `加载器的函数` , 它将可执行目标文件的代码和数据复制到内存,然后将控制转移到这个程序的开头.**
  * **`linux>   ./prog`**   

### 静态链接  **ld**

**数据节 : 可重定位目标文件\( .o \)由各种不同的代码和数据节组成, 每个节都是一个连续的字节序列.指令在一节中,初始化了的全局变量在另一节中, 未初始化的变量又在另一个节中**

* **符号解析**
  * **目标文件重定义和引用符号,\(符号对于一个函数,全局变量,或一个静态变量\).**
  * **目的是 将每个符号引用正好和一个符号定义关联起来.**
* **重定位**
  * **编译器和汇编器生成从地址0开始的代码和数据节.**
  * **链接器通过把每个符号定义于一个内存位置关联起来,从而重定位这些节.**
  * **然后修改所有对这些符号的引用, 使得它们指向那个内存位置.**

### **目标文件  \( .o \)**

* **三种目标文件形式**
  * **可重定位目标文件**
    * 就是**`.o 文件`**, 包含二进制代码和数据, 可以在编译时与其他可重定位目标文件合并起来,创建一个可执行文件.
    * 编译器和链接器 可以生成重定位目标文件. **`(ccl 和 as)`**
  * **可执行目标文件**
    * 包含二进制代码和数据, 可以直接复制到内存并执行. 也就是  **`.out 文件`**
    * 链接器可以生存执行目标文件.  \(**`ld )`**
  * **共享目标文件**
    * 一种特殊类型的可重定位目标文件, 可以在加载或运行时被动态地加载进内存并链接. 也就是 **`.dll 或 .so 动态库文件`**
    * gcc 可以生成这种文件

**一个`目标模块` 是一个`字节序列`, `目标文件`是以文件形式存放在磁盘中的`目标模块.`**

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

