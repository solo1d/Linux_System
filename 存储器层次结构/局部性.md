# 局部性

局部性, 它倾向于邻近于其他最近引用过的**数据项**的**数据项**, 或者最近引用过的**数据项本身**,这种倾向性, 被称为**局部性原理**.

* 局部性通常有两种不同的形式
  * **时间局部性**
    * 被引用过一次的内存位置很可能在不远的将来再被多次引用.
  * **空间局部性**
    * 如果一个内存位置被引用了一次, 那么程序很可能在不远的将来引用附近的内存位置.

1. 有良好的局部性的程序 比局部性差的程序运行的更快
   1. **硬件层**
      1. 计算机设计者通过引用**高速缓存存储器**的小而快速的存储器来保存最近被引用的指令和数据项, 从而提高对主存的访问速度.
   2. **操作系统级**
      1. 操作系统用主存来缓存磁盘文件系统中最近被使用磁盘块.
   3. **程序应用**
      1. Web 服务器将最近被引用的文档放在本地磁盘上, 大容量的Web服务器将最近被请求的文档放在前端磁盘高速缓存中, 这些缓存能满足对这些文档的要求, 而不需要服务器的任何干预.

* 量化评价程序中局部性的一些简单原则
  * 重复引用相同变量的程序有良好的时间局部性.
  * 对于具有步长为 k  的引用模式的程序,步长越小, 空间局部性越好.
  * 对于取指令来说, 循环有好的时间和空间局部性. 循环体越小, 循环迭代次数越多, 局部性越好.

### 在程序中利用局部性

* 将注意力集中在内循环上, 大部分计算和内存访问都发生在这里.
* 通过按照数据对象存储在内存中的顺序, 以步长为1 的来读数据, 从而使得程序中的空间局部性最大.
* 一旦从存储器读入了一个数据对象, 就尽可能多的使用它, 从而使得程序中的时间局部性最大.

## 矩阵乘法代码示例   \(速度非常快\)

```c
    int A[N][N] =  { 1 ,3 , 5, 7};
    int B[N][N] =  { 2 ,4 , 6, 8};
    int C[N][N] =  {0};
    int r = 0;
    int k,i,j;
    for(k=0; k<N; k++)
        for(i=0; i<N; i++){
            r=A[i][k];
            for(j=0; j<N; j++)
                C[i][j] += r*B[k][j];
        }
```

